var aDay=["sun","mon","tue","wed","thu","fri","sat"],aMonth=["January","February","March","April","May","June","July","August","September","October","November","December"],$li="",d=new Date,iDay=d.getDate(),iMonth=d.getMonth()+1,iYear=d.getFullYear(),iNum_of_days=new Date(iYear,iMonth,0).getDate(),c=new Date;c.setDate(1);var iGetday=c.getDay(),day_start=iGetday,oTitle=$("#title"),oMessage=$("#message"),oImg='<tr><td colspan="4"><img src="./img/loader_small.gif" /></td></tr>';$(document).ready(function(){for(i=0;i<=6;i++){var a=0!=i&&6!=i?"week_days":"week_ends";$li+="<li class='"+a+"'>"+aDay[i]+"</li>"}$("#holder").append("<div class='heading_title'><ul class='class_ul'>"+$li+"</ul></div>"),oCalendar.viewCalendar(iDay,iMonth,iYear,iNum_of_days,day_start),$(".date_navi").click(function(){var a=parseInt($("#hidden_month").val()),b=parseInt($("#hidden_year").val());oCalendar.navi($(this).attr("id"),d,a,b)}),$(".time_field").timepicker(),$(".time_field").val(""),$("#btn_add").click(function(){var a=$("#event").val(),b=$("#from").val(),c=$("#to").val(),d=$("#location").val(),e=$("#hidden_selected_date").val();$.ajax({url:oCalendar.base_url()+"calendar/add_record",type:"post",data:{event:a,from:b,to:c,location:d,date:e},success:function(a){1==a&&(oCalendar.updateTotalEvent("plus",e),oCalendar.clickDay(!1,e),$("#btn_add").attr("disabled",!0))}})}),$("#calendar_table tbody tr").live("click",function(){var a=$(this);if(1===a.find("td").length)return!1;var b=a.attr("id"),c=a.find("td:eq(1)").text(),d=a.find("td:eq(2)").text();d=d.split("~");var e=$.trim(d[0]),f=$.trim(d[1]),g=a.find("td:eq(3)").text();$("#btn_add").hide(),$("#btn_update").attr("disabled",!1),$("#btn_update").show(),$("#btn_delete").show(),$("#btn_cancel").show(),$("#event").val(c),$("#from").val(e),$("#to").val(f),$("#location").val(g),$("#hidden_id").val(b)}),$("#btn_update").click(function(){var a=$("#event").val(),b=$("#from").val(),c=$("#to").val(),d=$("#location").val(),e=$("#hidden_id").val();$.ajax({url:oCalendar.base_url()+"calendar/update_record",type:"post",data:{id:e,data:{event:a,from_time:b,to_time:c,location:d}},success:function(a){1==a&&(oCalendar.clickDay(!1,$("#hidden_selected_date").val()),oCalendar.resetButtons())}})}),$("#btn_delete").click(function(){$.ajax({url:oCalendar.base_url()+"calendar/delete_record",type:"post",data:{id:$("#hidden_id").val()},success:function(a){1==a&&(oCalendar.updateTotalEvent("minus",$("#hidden_selected_date").val()),oCalendar.clickDay(!1,$("#hidden_selected_date").val()),oCalendar.resetButtons())}})}),$("#btn_cancel").click(function(){oCalendar.resetButtons(),$("#event, #from, #to, #location").val("")}),oCalendar.checkDataField()});var oCalendar={base_url:function(){return $("#base_url").val()},getRecord:function(a,b){$.ajax({url:oCalendar.base_url()+"calendar/get_data",type:"post",dataType:"json",data:{month:a,year:b},success:function(c){$.each(c,function(c,d){var e=d.date.split("-"),f=parseInt(e[2]-1),g=""==$.trim($("#holder").find(".days").eq(f).find("span:last").text())?0:$("#holder").find(".days").eq(f).find("span:last").text();e[1]==a&&e[0]==b&&(g=parseInt(g)+1,$("#holder").find(".days").eq(f).find("span:last").text(g))})}})},updateTotalEvent:function(a,b){var c=b.split("-"),d=parseInt(c[2]),e=$.trim($(".days").eq(d-1).find(".numDate2").text());e=""==e?0:parseInt(e),"plus"==a?$(".days").eq(d-1).find(".numDate2").text(e+1):1==e?$(".days").eq(d-1).find(".numDate2").html("&nbsp;"):$(".days").eq(d-1).find(".numDate2").text(e-1)},checkDataField:function(){$("#event, #location").keyup(function(){var a=$.trim($("#event").val()),b=$.trim($("#location").val()),c=$.trim($("#from").val()),d=$.trim($("#to").val());a.length>0&&b.length>0&&c.length>0&&d.length>0?$("#btn_add, #btn_update").attr("disabled",!1):$("#btn_add, #btn_update").attr("disabled",!0)}),$("#from, #to").click(function(){var a=$.trim($("#event").val()),b=$.trim($("#location").val()),c=$.trim($("#from").val()),d=$.trim($("#to").val());a.length>0&&b.length>0&&c.length>0&&d.length>0?$("#btn_add, #btn_update").attr("disabled",!1):$("#btn_add, #btn_update").attr("disabled",!0)})},clickDay:function(a,b){$.ajax({url:oCalendar.base_url()+"calendar/get_by_date_record",type:"post",dataType:"json",data:{search:b},success:function(a){var b="";return 0==a.length?($("#calendar_table tbody").html('<tr><td colspan="4"><center>No event</center></td></tr>'),!1):($.each(a,function(a,c){b+='<tr id="'+c.id+'">',b+="<td>"+(a+1)+"</td>",b+="<td>"+c.event+"</td>",b+="<td>"+c.from_time+" ~ "+c.to_time+"</td>",b+="<td>"+c.location+"</td>",b+="</tr>"}),void $("#calendar_table tbody").html(b))}}).done(function(){$("#event, #from, #to, #location").val(""),$("#hidden_selected_date").val(b),1==a&&(oCalendar.resetButtons(),$("#calendarModal").modal("show"))})},navi:function(a,b,c,d){"left_navi"===a?(c--,0==c&&(d--,c=12)):"right_navi"===a&&(c++,13==c&&(d++,c=1));var e=new Date,f=e.getDate(),g=e.getMonth()+1,h=e.getFullYear();if(b.setDate(1),b.setMonth(c-1),b.setYear(d),g==c&&h==d)var i=new Date(h,g,0).getDate(),j=b.getDay(),k=f;else var i=new Date(d,c,0).getDate(),j=b.getDay(),k="";oCalendar.viewCalendar(k,c,d,i,j)},viewCalendar:function(a,b,c,d,e){0==b?b=12:b>=13&&(b=1),$("#hidden_month").val(b),$("#hidden_year").val(c),$(".class_ul2").remove();var f="";$("#month_title").html(aMonth[b-1]+" "+c),f=34,2!=b?5===e?f=31==d?41:34:6===e&&(f=d>=30?41:34):f=0===e&&28===d?27:34;var g="",h="",j="",k="days";for(i=0;i<=f;i++)h=e<=i?g++>=d?"&nbsp;":g:"&nbsp;",k=e<=i?g>d?"box":"days":"box",j+="<li class='"+k+"'><span class='numDate'>"+h+"</span><span class='numDate2'>&nbsp;</span></li>";$("#holder").append("<ul class='class_ul2'>"+j+"</ul>"),""!==a&&$("#holder").find(".days").eq(a-1).addClass("today"),oCalendar.getRecord(b,c),$(".days").click(function(){var a=c+"-"+b+"-"+$(this).find("span:first").text();oCalendar.clickDay(!0,a)})},resetButtons:function(){$("#btn_add").attr("disabled",!0).show(),$("#btn_update,#btn_delete,#btn_cancel").hide()}};